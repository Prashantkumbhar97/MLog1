<template>
    <div class="slds-box slds-theme_default" style="margin-bottom:10px;">
        <div class="slds-page-header" style="padding:0 0 0 10px;">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <span class="slds-icon_container slds-icon-action-account" title="PRODUCTS DETAILS">
                                <lightning-icon icon-name="standard:product_item" title="PRODUCTS DETAILS" size="medium"> </lightning-icon> 
                                <span class="slds-assistive-text">PRODUCTS DETAILS</span>
                            </span>
                        </div>
            
                        <div class="slds-media__body">
                            <div class="slds-page-header__name">
                                <div class="slds-page-header__name-title">
                                    <h1>
                                        <span class="slds-page-header__title slds-truncate" title="PRODUCTS DETAILS" style="margin-top:12px; text-transform:uppercase;">PRODUCTS DETAILS</span>
                                    </h1>
                                </div>
                            </div>
                        </div>
                        <lightning-button variant="brand" icon-name="utility:add" title="ADD" class="slds-m-right_x-small slds-float_right" style="margin-top:8px;" onclick={openModal}></lightning-button>
            
                    </div>
                </div>
            </div>
        </div>

            <!--<div style="background: rgb(0 156 219); color:#fff; font-size:15px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                <h4>PRODUCTS DETAILS</h4>
            </div>-->

        <div class="slds-scrollable_x">
            <table class="slds-table slds-table_bordered" aria-labelledby="element-with-table-label other-element-with-table-label" style="border:1px solid rgb(229, 229, 229);">
                <thead>
                    <tr class="slds-hint-parent">
                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>INVOICE</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>PRODUCT CODE</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>PRODUCT NAME</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>VOLUME (KG/LT)*</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>UNIT VALUE</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>TOTAL VALUE*</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>EXPIRE DATE*</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>BATCH</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title="" style="text-align: center;"><strong>ACTION</strong></div>
                        </th>
                    </tr>
                </thead>
                <tbody>  
                    <template if:true={isProductList}>
                        <template for:each={productList} for:item="prod" for:index="i">      
                            <tr class="slds-hint-parent" key={prod.srNo}>
                            
                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="text"  value={prod.invoiceName} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="text"  value={prod.productCode} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="text"  value={prod.productName} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="number"  value={prod.volume} disabled="true"></lightning-input>
                                    </div>
                                </td>    

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="number"  value={prod.unitValue} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="number"  value={prod.totalValue} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="date"  value={prod.expireDate} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="text"  value={prod.batch} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div>
                                        <lightning-button variant="brand" name={i} value={prod.recId} onclick={editProduct} title="Edit" icon-name="utility:edit" class="slds-m-right_x-small"></lightning-button>&nbsp;
                                        <lightning-button variant="destructive" name={i} value={prod.recId} onclick={removeProduct} title="Delete" icon-name="utility:delete" class="slds-m-right_x-small"></lightning-button>  
                                    </div>
                                </td>

                            </tr>
                        </template>
                    </template>
                    <template if:false={isProductList}>
                        <tr class="slds-hint-parent">
                            <td colspan="9"><div class="slds-truncate" title="" style="text-align:center;"><b>No Records Found</b></div></td>                         
                        </tr> 
                    </template>
                </tbody>
            </table>
        </div>


        <!--<div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12" style="margin:15px 0px 15px 0;  padding:10px; border-top: 1px solid rgb(229, 229, 229);">
        <lightning-button variant="Brand" label="Save" title="Save" class="slds-m-right_x-small slds-float_right"></lightning-button>
        <lightning-button variant="Brand" label="Cancel" title="Cancel" class="slds-m-right_x-small slds-float_right"></lightning-button>
        </div>-->

    </div>

    <!-- modal start -->  
    <template if:true={bShowModal}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-modal_large slds-fade-in-open" style="margin:0 auto; width:80%;">
            <template if:true={showSpinner}>
                <div class="exampleHolder">
                    <lightning-spinner alternative-text="PleaseWait" size="medium" variant="brand"></lightning-spinner>
                </div>
            </template>
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                        <lightning-icon icon-name="utility:close"
                        alternative-text="close"
                        variant="inverse"
                        size="small" ></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">PRODUCT SELECTION FORM</h2>
                </header>
                
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    
                    <div class="slds-grid slds-gutters slds-wrap">
                        <div style="background: rgb(0 156 219); color:#fff; font-size:12px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                            <h4>Invoice</h4>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex" style="padding-top:10px;">
                            <span>Invoice</span>
                            <c-lookupcmp placeholder="Select Invoice"  iconname='standard:budget_category_value' multiselect=false sobject='Invoice__c'
                                fieldname='OwnerId, Name, Sales_Org__c, Sold_To_Party__c ' 
                                filter={invcFilter} displayfield={invcSerarchField} onselected={handleInvoiceSelected} disable={invcDisable}
                                singleselectedrec={invcName} onremove={handleRemoveInvoice} cmpwidth='long'></c-lookupcmp>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex" style="padding-top:10px;">
                            <span>Product Code</span>
                            <c-lookupcmp placeholder="Select Product"  iconname='standard:product_item' multiselect=false sobject='Invoice_Line_Item__c '
                                fieldname=' Name, CurrencyIsoCode, Invoice__c, SKU__c, SKU_Code__c, SKU__r.Name ' 
                                filter={invcItemFilter} displayfield={invcItemSerarchField} onselected={handleInvoiceItemSelected} 
                                singleselectedrec={invcItemName} onremove={handleRemoveInvoiceItem} cmpwidth='long'></c-lookupcmp>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="prodDetals" label="PRODUCT DETAILS" value={productObj.productName} onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="batch" label="BATCH" value={productObj.batch} onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div style="background: rgb(0 156 219); color:#fff; font-size:12px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                            <h4>COMMERCIAL</h4>
                        </div>


                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="currencyCode" class="validt" label="Currency" value={productObj.currencyCode} required="true" onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="number" min="0" name="volume" class="validt" label="VOLUME (KG/LT)" value={productObj.volume} required="true" onblur={handleVolumeChange}></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="number" name="unitVal" class="validt" label="UNIT VALUE" value={productObj.unitValue} onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="totalVal" class="validt" label="TOTAL VALUE" value={productObj.totalValue} required="true" onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="date" name="expDate" class="validt" label="EXPIRE DATE" value={productObj.expireDate} required="true" onchange={handleChange} disabled="true"></lightning-input>
                        </div>


                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label="AT AG?" name="atAg" class="validt" options={atAgOptions} value={productObj.atAG} onchange={handleChange} required="true"> 
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label="PRODUCT DAMAGED?" name="prodDamage" class="validt" value={productObj.productDamage} options={prodDamageOptions} onchange={handleChange} required="true"> 
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label="PACKAGING CONDITIONS?" name="packCondtn" class="validt" value={productObj.packagingCondition} options={packgCondtnOptions} onchange={handleChange} required="true"> 
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label="PRODUCT CONDITIONS?" name="prodCondtn" class="validt" value={productObj.productCondition} options={prodCondtnOptions} onchange={handleChange} required="true"> 
                            </lightning-combobox>
                        </div>

                        <div style="background: rgb(0 156 219); color:#fff; font-size:12px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                            <h4>COMMENTS</h4>
                        </div>


                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_12-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="comments" label="COMMENTS" value={productObj.comments} onblur={handleChange}></lightning-input>
                        </div>


                        <div style="background: rgb(0 156 219); color:#fff; font-size:12px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                            <h4>QUALITY</h4>
                        </div>


                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label="SLOW MOVING" name="sloMo" value={productObj.slowMoving} options={slowMovOptions} onchange={handleChange} > 
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label="PRODUCT CONTENTION" name="prodConten" value={productObj.productContention} options={prodContentnOptions} onchange={handleChange} > 
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label="PRODUCT CAN BE REWORKED?" name="prodRewrk" value={productObj.productRework} options={prodReworkOptions} onchange={handleChange} > 
                            </lightning-combobox>
                        </div>

                        <template if:true={reworkYes}>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                                <lightning-input type="number" min="0" name="reworkCost" label="REWORK COST" value={productObj.reworkCost} onblur={handleChange}></lightning-input>
                            </div>
                        </template>

                        <template if:true={reworkNo}>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                                <lightning-input type="text" name="writeOff" label="Write-Off" value={productObj.writeOff} onblur={handleChange}></lightning-input>
                            </div>
                        </template>

                    </div>
                </div>
            
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_brand" onclick={saveProduct}>Save</button>
                    <button class="slds-button slds-button_destructive" onclick={closeModal}>Cancel</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>